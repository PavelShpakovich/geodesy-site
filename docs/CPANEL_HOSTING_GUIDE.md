# Руководство по cPanel и хостингу domain.by

## Обзор

**cPanel** — это панель управления веб-хостингом. Через неё ты управляешь сайтом, почтой, базами данных и файлами на сервере.

**Твой хостинг:**

- **Провайдер:** domain.by (Беларусь)
- **Тип:** Shared hosting (общий хостинг)
- **Панель:** cPanel
- **Сервер:** s6.domain.by (IP: 93.84.119.241)

---

## Разделы cPanel

### 📧 Почта

| Инструмент                  | Описание                                             |
| --------------------------- | ---------------------------------------------------- |
| **Почтовые учетные записи** | Создание email адресов (например, info@mygeodesy.by) |
| **Правила пересылки**       | Перенаправление писем на другой адрес                |
| **Автоответчики**           | Автоматические ответы (отпуск, уведомления)          |
| **Спам-фильтры**            | Настройка фильтрации спама                           |
| **Отслеживание отправки**   | Логи отправленных писем                              |

**Как создать почту:**

1. Почтовые учетные записи → Создать
2. Указать имя (info, contact, support)
3. Задать пароль
4. Готово! Почта: info@mygeodesy.by

**Доступ к почте:**

- Веб-интерфейс: https://webmail.mygeodesy.by
- Или настроить в почтовом клиенте (Outlook, Mail, Thunderbird)

---

### 📁 Файлы

| Инструмент                  | Описание                                                 |
| --------------------------- | -------------------------------------------------------- |
| **Менеджер файлов**         | Просмотр и редактирование файлов на сервере (как Finder) |
| **Использование диска**     | Сколько места занято                                     |
| **Учетные записи FTP**      | Дополнительные FTP-аккаунты                              |
| **Создать резервную копию** | Бэкап всего сайта                                        |
| **Git Version Control**     | Управление Git репозиториями (нам не нужен)              |

**Важные папки:**

```
/home2/mygeodes/
├── public_html/          ← Корень сайта (сюда загружаем файлы)
│   ├── index.html        ← Главная страница
│   ├── .htaccess         ← Конфигурация Apache
│   └── api/contact.php   ← PHP обработчик форм
├── mail/                 ← Почтовые ящики
├── logs/                 ← Логи доступа и ошибок
├── ssl/                  ← SSL сертификаты
└── tmp/                  ← Временные файлы
```

**Советы по Менеджеру файлов:**

- Включи "Показать скрытые файлы" в настройках (чтобы видеть .htaccess)
- Можно редактировать файлы прямо в браузере
- Загружай ZIP архивы и распаковывай на сервере (быстрее чем много файлов)

---

### 🗄️ Базы данных

| Инструмент              | Описание                         |
| ----------------------- | -------------------------------- |
| **phpMyAdmin**          | Веб-интерфейс для работы с MySQL |
| **Manage My Databases** | Создание/удаление баз данных     |
| **Database Wizard**     | Пошаговое создание БД            |

**Для твоего сайта база данных НЕ нужна** — это статический сайт, контент берётся из Contentful.

---

### 🌐 Домены

| Инструмент          | Описание                        |
| ------------------- | ------------------------------- |
| **Домены**          | Управление доменами на аккаунте |
| **Перенаправления** | Редиректы (301, 302)            |
| **Редактор зоны**   | DNS записи (A, CNAME, TXT, MX)  |

**Редактор зоны — важно!**

Здесь добавляются:

- **A записи** — указывают домен на IP сервера
- **TXT записи** — верификация (Google, Yandex, SPF)
- **MX записи** — настройка почты
- **CNAME записи** — алиасы доменов

---

### 📊 Метрики

| Инструмент                 | Описание                      |
| -------------------------- | ----------------------------- |
| **Посетители**             | Статистика посещений          |
| **AWStats**                | Детальная аналитика           |
| **Ошибки**                 | Лог ошибок сервера (404, 500) |
| **Использование ресурсов** | CPU, память, I/O              |

**Для аналитики лучше использовать:**

- Яндекс.Метрика
- Google Analytics

Они дают больше данных чем встроенная статистика.

---

### 🔒 Безопасность

| Инструмент         | Описание                                    |
| ------------------ | ------------------------------------------- |
| **SSL/TLS**        | Управление сертификатами                    |
| **SSL/TLS Status** | Статус AutoSSL (автоматические сертификаты) |
| **Доступ по SSH**  | Терминал (если включен)                     |
| **Блокиратор IP**  | Заблокировать IP адреса                     |
| **ModSecurity**    | Веб-фаервол (WAF)                           |
| **ImunifyAV**      | Антивирус                                   |

**SSL сертификаты:**

- AutoSSL автоматически выпускает и обновляет Let's Encrypt сертификаты
- Обновляются каждые 90 дней автоматически
- Если что-то сломалось — нажми "Run AutoSSL" в SSL/TLS Status

---

### ⚙️ Программное обеспечение

| Инструмент            | Описание                                          |
| --------------------- | ------------------------------------------------- |
| **Выбор версии PHP**  | Переключение версии PHP (7.4, 8.0, 8.1, 8.2, 8.3) |
| **Менеджер MultiPHP** | PHP настройки для разных доменов                  |
| **Настройка Node.js** | Node.js приложения (не для статики)               |
| **Softaculous**       | Установка CMS в 1 клик (WordPress, Joomla)        |

**Версия PHP:**
Для `contact.php` нужен PHP 7.4+ (лучше 8.1 или 8.2).
Проверь в "Выбор версии PHP" что стоит актуальная версия.

---

### 🔧 Расширенный

| Инструмент             | Описание                      |
| ---------------------- | ----------------------------- |
| **Terminal**           | SSH терминал в браузере       |
| **Задания cron**       | Запуск скриптов по расписанию |
| **Страницы ошибок**    | Кастомные 404, 500 страницы   |
| **Обработчики Apache** | Настройка обработки файлов    |

**Задания cron — полезно для:**

- Очистка временных файлов
- Отправка отчётов
- Автоматические задачи

---

## Типы хостинга

### Shared Hosting (твой случай)

```
┌─────────────────────────────────────┐
│           Физический сервер         │
├─────────┬─────────┬─────────┬───────┤
│ Сайт A  │ Сайт B  │ Твой    │ ...   │
│         │         │ сайт    │       │
└─────────┴─────────┴─────────┴───────┘
```

**Плюсы:**

- ✅ Дёшево (~$3-10/мес)
- ✅ Просто управлять через cPanel
- ✅ SSL, почта, бэкапы включены

**Минусы:**

- ❌ Ресурсы делятся с другими сайтами
- ❌ Ограничения по CPU/памяти
- ❌ Нет root доступа

### VPS (Virtual Private Server)

```
┌─────────────────────────────────────┐
│           Физический сервер         │
├─────────────────┬───────────────────┤
│    VPS 1        │      VPS 2        │
│  (твой)         │   (другой)        │
│  ┌───────────┐  │                   │
│  │ Ubuntu    │  │                   │
│  │ nginx     │  │                   │
│  │ Node.js   │  │                   │
│  └───────────┘  │                   │
└─────────────────┴───────────────────┘
```

**Плюсы:**

- ✅ Выделенные ресурсы
- ✅ Root доступ (полный контроль)
- ✅ Можно ставить любой софт

**Минусы:**

- ❌ Дороже ($10-50/мес)
- ❌ Нужно самому настраивать сервер
- ❌ Сам отвечаешь за безопасность

### Dedicated Server

Целый физический сервер только для тебя.

- Для очень больших проектов
- $100-500+/мес

### Cloud/PaaS (Vercel, Netlify)

```
┌──────────────────────────────────────┐
│         Облачная платформа           │
│  ┌────────┐  ┌────────┐  ┌────────┐  │
│  │ Edge   │  │ Edge   │  │ Edge   │  │
│  │ Минск  │  │ Москва │  │ Берлин │  │
│  └────────┘  └────────┘  └────────┘  │
│         Твой сайт везде              │
└──────────────────────────────────────┘
```

**Плюсы:**

- ✅ Автомасштабирование
- ✅ CDN из коробки (быстро везде)
- ✅ CI/CD интеграция
- ✅ Serverless функции

**Минусы:**

- ❌ Нет контроля над сервером
- ❌ Может быть дорого при большом трафике
- ❌ Не подходит для Беларуси (требование локального хостинга)

---

## Архитектура твоего хостинга

### Как работает связка nginx + Apache

На shared хостингах обычно используется схема **nginx как reverse proxy перед Apache**:

```
        Пользователь
             │
             │ https://mygeodesy.by/api/contact.php
             ▼
    ┌─────────────────┐
    │      nginx      │  Порт 443 (HTTPS) / 80 (HTTP)
    │  (reverse proxy)│
    │                 │
    │ • SSL терминация│  ← Расшифровывает HTTPS
    │ • Кэширование   │  ← Кэширует статику
    │ • Балансировка  │  ← Распределяет нагрузку
    └────────┬────────┘
             │
             │ Проксирует на localhost:8080
             ▼
    ┌─────────────────┐
    │     Apache      │  Порт 8080 (локальный)
    │   (backend)     │
    │                 │
    │ • .htaccess     │  ← Читает твои правила
    │ • mod_rewrite   │  ← Переписывает URL
    │ • mod_php       │  ← Выполняет PHP
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │  PHP Interpreter│
    │                 │
    │ contact.php     │  ← Твой скрипт
    │     │           │
    │     ▼           │
    │  mail()         │  ← Отправка письма
    └─────────────────┘
```

### Что делает nginx?

```nginx
# Упрощённая конфигурация nginx (ты её НЕ видишь и НЕ редактируешь)
# Находится в /etc/nginx/conf.d/ (доступ только у администратора сервера)

server {
    listen 443 ssl;
    server_name mygeodesy.by;

    # SSL сертификаты (управляются через AutoSSL)
    ssl_certificate /home2/mygeodes/ssl/mygeodesy.by.crt;
    ssl_certificate_key /home2/mygeodes/ssl/mygeodesy.by.key;

    # Статика отдаётся напрямую (быстро!)
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff2)$ {
        root /home2/mygeodes/public_html;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # Всё остальное → Apache
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**Ключевой момент:** nginx настроен хостингом, ты его не трогаешь!

### Что делает Apache?

```apache
# Apache читает .htaccess из /home2/mygeodes/public_html/.htaccess
# Это ТВОЙ файл, который ты загрузил

# Твой .htaccess:
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # HTTPS редирект
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>
```

### Как запускается PHP скрипт?

Пошаговый процесс когда пользователь отправляет форму:

```
1. Браузер отправляет POST запрос
   ─────────────────────────────────────────────────────────
   POST /api/contact.php HTTP/1.1
   Host: mygeodesy.by
   Content-Type: application/json

   {"type":"contact","name":"Иван","phone":"+375291234567",...}

2. nginx получает запрос на порт 443
   ─────────────────────────────────────────────────────────
   • Расшифровывает SSL
   • Видит что это .php файл
   • Проксирует на Apache (localhost:8080)

3. Apache получает запрос
   ─────────────────────────────────────────────────────────
   • Читает .htaccess (если есть правила)
   • Видит расширение .php
   • Передаёт в PHP интерпретатор

4. PHP выполняет contact.php
   ─────────────────────────────────────────────────────────
   • Читает $_POST / file_get_contents('php://input')
   • Выполняет логику (валидация, mail())
   • Возвращает JSON ответ

5. Ответ идёт обратно
   ─────────────────────────────────────────────────────────
   PHP → Apache → nginx → Браузер
```

### Где какие настройки?

| Что             | Где находится                  | Кто управляет           |
| --------------- | ------------------------------ | ----------------------- |
| nginx config    | `/etc/nginx/`                  | Хостинг (domain.by)     |
| Apache config   | `/etc/apache2/`                | Хостинг                 |
| .htaccess       | `/home2/mygeodes/public_html/` | **Ты!**                 |
| PHP конфиг      | `/etc/php.ini`                 | Хостинг + частично ты   |
| SSL сертификаты | `/home2/mygeodes/ssl/`         | AutoSSL (автоматически) |
| Твои файлы      | `/home2/mygeodes/public_html/` | **Ты!**                 |

### Что ты можешь настроить?

#### 1. Через .htaccess (Apache)

```apache
# Редиректы
RewriteRule ^old-page$ /new-page [R=301,L]

# Защита папок
<Directory /admin>
    Require ip 192.168.1.0/24
</Directory>

# Кастомные ошибки
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Заголовки безопасности
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"

# Кэширование
<IfModule mod_expires.c>
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
</IfModule>

# Gzip сжатие
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/css application/javascript
</IfModule>
```

#### 2. Через cPanel

- **Выбор версии PHP** — переключить PHP 7.4 → 8.2
- **PHP Extensions** — включить/выключить модули
- **php.ini директивы** — memory_limit, upload_max_filesize

#### 3. Через файл .user.ini (PHP)

Создай файл `/home2/mygeodes/public_html/.user.ini`:

```ini
; Лимит памяти для PHP
memory_limit = 256M

; Максимальный размер загружаемого файла
upload_max_filesize = 10M
post_max_size = 10M

; Таймаут выполнения
max_execution_time = 60

; Отображение ошибок (только для отладки!)
display_errors = Off
log_errors = On
```

### Почему именно такая архитектура?

```
┌─────────────────────────────────────────────────────────────┐
│                     Без nginx                                │
│                                                              │
│   Клиент ──► Apache (обрабатывает ВСЁ)                      │
│                                                              │
│   Проблема: Apache тяжёлый, создаёт процесс на каждый       │
│   запрос, даже для отдачи картинки                          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    С nginx (твой случай)                     │
│                                                              │
│   Клиент ──► nginx ──► Apache                               │
│               │                                              │
│               └──► Статика (быстро, без Apache)             │
│                                                              │
│   Преимущества:                                              │
│   • nginx отдаёт 10,000+ статических файлов в секунду       │
│   • Apache работает только когда нужен PHP                  │
│   • Меньше нагрузка на сервер                               │
│   • Лучше кэширование                                        │
└─────────────────────────────────────────────────────────────┘
```

### Практический пример: путь запроса

**Запрос статики (HTML страница):**

```
GET https://mygeodesy.by/about/

1. nginx видит запрос
2. Проверяет: есть /about/index.html? Да!
3. Отдаёт файл НАПРЯМУЮ (Apache не участвует)
4. Время ответа: ~50ms
```

**Запрос PHP (отправка формы):**

```
POST https://mygeodesy.by/api/contact.php

1. nginx видит .php расширение
2. Проксирует на Apache
3. Apache вызывает PHP
4. PHP выполняет скрипт, отправляет mail()
5. PHP возвращает JSON
6. Apache → nginx → браузер
7. Время ответа: ~200-500ms
```

### Как проверить что PHP работает?

Создай тестовый файл `public_html/info.php`:

```php
<?php
phpinfo();
```

Открой https://mygeodesy.by/info.php — увидишь всю информацию о PHP.

**⚠️ Удали после проверки!** Это раскрывает информацию о сервере.

---

## Важные файлы

### .htaccess

Конфигурация Apache. Влияет на:

- Редиректы (HTTP → HTTPS)
- Кэширование
- Сжатие (gzip)
- Безопасность (headers)
- Кастомные страницы ошибок

```apache
# Пример: редирект на HTTPS
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
```

### robots.txt

Указывает поисковикам что индексировать:

```
User-agent: *
Allow: /
Sitemap: https://mygeodesy.by/sitemap.xml
```

### sitemap.xml

Карта сайта для поисковиков. Генерируется автоматически при сборке.

---

## Лимиты shared хостинга

| Ресурс                | Типичный лимит              |
| --------------------- | --------------------------- |
| Дисковое пространство | 5-50 GB                     |
| Трафик                | Безлимит или 100-500 GB/мес |
| CPU                   | 1-2 ядра (shared)           |
| RAM                   | 512MB - 2GB                 |
| PHP процессы          | 5-20 одновременно           |
| Email аккаунты        | 10-100                      |
| Базы данных           | 5-20                        |

Для статического сайта этого более чем достаточно!

---

## Частые проблемы и решения

### Сайт не открывается

1. Проверь DNS: `dig mygeodesy.by`
2. Проверь что файлы в `public_html/`
3. Проверь что есть `index.html`

### 500 Internal Server Error

1. Проверь логи: Метрики → Ошибки
2. Проверь .htaccess на синтаксические ошибки
3. Проверь права на файлы (должны быть 644 для файлов, 755 для папок)

### 404 Not Found

1. Проверь что файл существует
2. Проверь путь (регистр важен!)
3. Проверь .htaccess правила

### Формы не работают

1. Проверь что `api/contact.php` существует
2. Проверь версию PHP (нужна 7.4+)
3. Посмотри логи ошибок PHP

### SSL не работает

1. SSL/TLS Status → Run AutoSSL
2. Подожди 5-10 минут
3. Очисти кэш браузера

### Письма не доходят

1. Проверь Отслеживание отправки
2. Проверь спам-папку получателя
3. Добавь SPF запись в DNS:
   ```
   v=spf1 +a +mx +ip4:93.84.119.241 ~all
   ```

---

## Бэкапы

### Автоматические (если включены)

Хостинг делает бэкапы раз в день/неделю.
Восстановление через техподдержку.

### Ручные

1. Создать резервную копию → Полная резервная копия
2. Скачай ZIP файл
3. Храни в безопасном месте

**Для твоего сайта:**

- Код хранится в GitHub — это твой бэкап
- Контент в Contentful — там свои бэкапы
- Достаточно бэкапить только `contact.php` и `.htaccess`

---

## Полезные команды (если есть SSH)

```bash
# Проверить версию PHP
php -v

# Проверить место на диске
du -sh public_html/

# Найти большие файлы
find public_html/ -size +10M

# Проверить права
ls -la public_html/

# Исправить права
chmod 644 public_html/*.html
chmod 755 public_html/api/
```

---

## Контакты поддержки

**domain.by:**

- Сайт: https://domain.by
- Личный кабинет: https://my.domain.by
- Телефон: +375 (17) 336-06-06

При обращении указывай:

- Логин: mygeodes
- Домен: mygeodesy.by

---

## Чеклист после настройки

- [x] SSL сертификат установлен
- [x] Сайт открывается по HTTPS
- [ ] Создать почту info@mygeodesy.by (опционально)
- [ ] Добавить SPF запись для почты (если нужна)
- [ ] Настроить бэкапы
- [ ] Сохранить доступы в надёжном месте
